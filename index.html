<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë°€í¬í‹° ê³ ê°ì„¼í„° ë¶ˆë§Œ ê°ì§€ ì‹œìŠ¤í…œ</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#003366">
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./service-worker.js');
}
</script>
<style>
    body {
        font-family: 'Noto Sans KR', sans-serif;
        background-color: #f4f6f8;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 20px;
    }
    header {
        background: linear-gradient(135deg, #003366, #00509e);
        color: white;
        padding: 20px;
        font-size: 1.8em;
        font-weight: bold;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        border-radius: 0 0 12px 12px;
        text-align: center;
    }
    main {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        margin-top: 20px;
    }
    .notice {
        background-color: #f9fafb;
        border-left: 5px solid #00509e;
        padding: 15px 20px;
        margin-bottom: 20px;
        line-height: 1.6;
        font-size: 0.95em;
    }
    .notice strong {
        color: #c0392b;
        font-weight: bold;
    }
    .input-area {
        width: 100%;
        min-height: 150px;
        padding: 15px;
        box-sizing: border-box;
        font-size: 1em;
        border: 1px solid #ccc;
        border-radius: 8px;
        background: white;
        outline: none;
        white-space: pre-wrap;
        word-break: break-word;
        transition: border-color 0.3s, background-color 0.3s;
    }
    .input-area:empty:before {
        content: attr(data-placeholder);
        color: #aaa;
    }
    .highlight {
        color: #c0392b;
        font-weight: bold;
    }
    .result {
        margin-top: 20px;
        padding: 20px;
        border-radius: 8px;
        font-weight: bold;
        font-size: 1.1em;
        display: none;
    }
    .normal {
        background-color: #e6f4ea;
        border: 1px solid #2e7d32;
        color: #1b5e20;
    }
    .complaint {
        background-color: transparent;
        border: none;
        color: #c0392b;
    }
    .warning {
        border-color: red !important;
        background-color: #ffe5e5;
        animation: blinkBorder 1s ease-in-out 2;
    }
    @keyframes blinkBorder {
        0%, 100% { border-color: red; }
        50% { border-color: #ff9b9b; }
    }
    .keywords {
        margin-top: 10px;
        font-size: 0.95em;
    }
    .keyword {
        display: inline-block;
        background-color: #ffcccc;
        color: #900;
        padding: 2px 6px;
        margin: 2px;
        border-radius: 4px;
        font-weight: bold;
        cursor: pointer;
    }
    .keyword-desc {
        margin-top: 8px;
        padding: 10px;
        background: #f1f1f1;
        border-radius: 6px;
        font-size: 0.9em;
        display: none;
    }
    .guide-text {
        font-size: 0.85em;
        color: #666;
        margin-top: 4px;
    }
    #securityStatus {
        margin-top: 20px;
        font-weight: bold;
        font-size: 0.85em;
        text-align: left;
        color: green;
    }
    /* ì„¤ì¹˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #installTrigger {
        display: none;
        margin: 20px auto;
        padding: 10px 20px;
        font-size: 1em;
        background: #003366;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }
</style>
</head>
<body>

<div class="container">
    <header>ë°€í¬í‹° ê³ ê°ì„¼í„° ë¶ˆë§Œ ê°ì§€ ì‹œìŠ¤í…œ</header>

    <main>
        <div class="notice">
            ìƒë‹´ ë‚´ìš©ì„ ì…ë ¥í•˜ë©´, ë¶ˆë§Œìœ¼ë¡œ ì˜ì‹¬ë˜ëŠ” í‘œí˜„ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°ì§€í•˜ì—¬ ê²°ê³¼ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.<br>
            í•´ë‹¹ ê²°ê³¼ë¥¼ ì°¸ê³ í•˜ì—¬ <strong>VOC êµ¬ë¶„ ì…ë ¥</strong>ì„ í•©ë‹ˆë‹¤.<br>
            <strong>ì´ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©°, ìµœì¢… íŒë‹¨ì€ ìƒë‹´ì‚¬ê°€ ì§ì ‘ í•´ì•¼í•©ë‹ˆë‹¤.</strong>
        </div>

        <div id="inputArea" class="input-area" contenteditable="true" spellcheck="false" data-placeholder="ìƒë‹´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></div>

        <div id="resultBox" class="result"></div>
        <div id="keywordList" class="keywords"></div>
        <div class="guide-text" id="clickGuide" style="display:none;">ê°ì§€ëœ í‚¤ì›Œë“œë¥¼ í´ë¦­í•˜ë©´ ì„¤ëª…ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
        <div id="keywordDesc" class="keyword-desc"></div>

        <!-- í•­ìƒ ë³´ì´ëŠ” ì„¤ì¹˜ ë²„íŠ¼ -->
        <button id="installTrigger">ğŸ“² ì•± ì„¤ì¹˜</button>
    </main>

    <div id="securityStatus">ğŸ”’ ë³´ì•ˆ ìƒíƒœ: ì•ˆì „ â€” ì™¸ë¶€ ì „ì†¡ ì—†ìŒ</div>
</div>

<script>
    const inputArea = document.getElementById('inputArea');
    const resultBox = document.getElementById('resultBox');
    const keywordList = document.getElementById('keywordList');
    const keywordDescBox = document.getElementById('keywordDesc');
    const clickGuide = document.getElementById('clickGuide');

    const complaintKeywords = ["ë¶ˆë§Œ", "ë¶ˆì¾Œ", "í•­ì˜", "ì§œì¦", "ì‹¤ë§", "ë¶ˆì¹œì ˆ",
    "ê¸°ë¶„ ë‚˜ë¹´", "ì–¸ì§¢", "ë¬´ë¡€", "ë¶€ë‹¹", "ê¸°ë¶„ ìƒí–ˆ", "ê°•ì„±", "ì‹ ê³ ", "ê²½ì°°", "ì†Œë³´ì›", "ì†Œë¹„ìë³´í˜¸ì›", "ì†Œë¹„ì ë³´í˜¸ì›", "ìš•ì„¤", "ìµœì•…", "ë²•ì ëŒ€ì‘"];

    const keywordDescriptions = {
        "ë¶ˆë§Œ": "ì„œë¹„ìŠ¤ë‚˜ ì œí’ˆì— ëŒ€í•œ ì „ë°˜ì ì¸ ë¶ˆë§Œ í‘œí˜„ì…ë‹ˆë‹¤.",
        "ë¶ˆì¾Œ": "ê³ ê°ì´ ê¸°ë¶„ì´ ìƒí•˜ê±°ë‚˜ ë¶ˆì¾Œê°ì„ ëŠë‚€ ìƒí™©ì…ë‹ˆë‹¤.",
        "í•­ì˜": "ë¬¸ì œ ì œê¸°ì™€ í•¨ê»˜ ì‹œì • ìš”êµ¬ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.",
        "ì§œì¦": "ë¶ˆí¸Â·ë¶ˆë§Œì´ ê°ì •ì ìœ¼ë¡œ í‘œì¶œëœ ìƒíƒœì…ë‹ˆë‹¤.",
        "ì‹¤ë§": "ê¸°ëŒ€ì— ë¯¸ì¹˜ì§€ ëª»í•´ ë¶€ì •ì  í‰ê°€ë¥¼ í•˜ëŠ” ê²½ìš°ì…ë‹ˆë‹¤.",
        "ë¶ˆì¹œì ˆ": "ì‘ëŒ€ íƒœë„ë‚˜ ì„œë¹„ìŠ¤ ë§¤ë„ˆì— ëŒ€í•œ ë¶€ì •ì  í”¼ë“œë°±ì…ë‹ˆë‹¤.",
        "ê¸°ë¶„ ë‚˜ë¹´": "ë°œì–¸Â·í–‰ë™ìœ¼ë¡œ ì¸í•´ ê°ì •ì´ ìƒí•œ ìƒíƒœì…ë‹ˆë‹¤.",
        "ì–¸ì§¢": "ì‚¬ì†Œí•´ ë³´ì´ì§€ë§Œ ë¶ˆë§Œìœ¼ë¡œ ë²ˆì§ˆ ìˆ˜ ìˆëŠ” ê°ì • í‘œí˜„ì…ë‹ˆë‹¤.",
        "ë¬´ë¡€": "ì˜ˆì˜ ì—†ëŠ” íƒœë„ë‚˜ ë°œì–¸ì— ëŒ€í•œ ì§€ì ì…ë‹ˆë‹¤.",
        "ë¶€ë‹¹": "ë¶ˆê³µì •Â·ë¶€ì •í™•í•œ ì²˜ë¦¬ì— ëŒ€í•œ ë¬¸ì œ ì œê¸°ì…ë‹ˆë‹¤.",
        "ê¸°ë¶„ ìƒí–ˆ": "ê³ ê° ê°ì •ì´ í¬ê²Œ ìƒí•œ ìƒíƒœë¡œ, ì§„ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.",
        "ê°•ì„±": "ê°•ê²½í•œ ì–´ì¡°ë¡œ ë¶ˆë§Œì„ ì œê¸°í•˜ëŠ” ê²½ìš°ì…ë‹ˆë‹¤.",
        "ì‹ ê³ ": "ì™¸ë¶€ ê¸°ê´€ì— ë¬¸ì œë¥¼ ì•Œë¦¬ê² ë‹¤ëŠ” ì˜ì‚¬ í‘œí˜„ì…ë‹ˆë‹¤.",
        "ê²½ì°°": "ë²•ì Â·í˜•ì‚¬ì  ì¡°ì¹˜ë¥¼ ì•”ì‹œí•˜ëŠ” ë°œì–¸ì…ë‹ˆë‹¤.",
        "ì†Œë³´ì›": "ì†Œë¹„ìë³´í˜¸ì›ì— ì‹ ê³  ì˜ì‚¬ë¥¼ ë°íˆëŠ” ê²½ìš°ì…ë‹ˆë‹¤.",
        "ì†Œë¹„ìë³´í˜¸ì›": "ì†Œë¹„ìë³´í˜¸ì›ì— ì‹ ê³  ì˜ì‚¬ë¥¼ ë°íˆëŠ” ê²½ìš°ì…ë‹ˆë‹¤.",
        "ì†Œë¹„ì ë³´í˜¸ì›": "ì†Œë¹„ìë³´í˜¸ì›ì— ì‹ ê³  ì˜ì‚¬ë¥¼ ë°íˆëŠ” ê²½ìš°ì…ë‹ˆë‹¤.",
        "ìš•ì„¤": "ë¶€ì ì ˆí•œ ì–¸ì–´ ì‚¬ìš©ìœ¼ë¡œ ê°ì •ì´ ê²©í•´ì§„ ìƒíƒœì…ë‹ˆë‹¤.",
        "ìµœì•…": "ë§¤ìš° ê°•í•œ ë¶€ì • í‰ê°€ë¡œ, ë¶ˆë§Œ ê°•ë„ê°€ ë†’ìŠµë‹ˆë‹¤.",
        "ë²•ì ëŒ€ì‘": "ë²•ì  ì ˆì°¨ë¥¼ ì§„í–‰í•˜ê² ë‹¤ëŠ” ì˜ì‚¬ í‘œí˜„ì…ë‹ˆë‹¤."
    };

    let isComposing = false;

    inputArea.addEventListener('compositionstart', () => { isComposing = true; });
    inputArea.addEventListener('compositionend', () => { isComposing = false; processText(); });
    inputArea.addEventListener('input', () => { if (!isComposing) processText(); });

    function processText() {
        let text = inputArea.innerText;
        if (!text.trim()) {
            resultBox.style.display = "none";
            keywordList.innerHTML = "";
            keywordDescBox.style.display = "none";
            clickGuide.style.display = "none";
            inputArea.classList.remove("warning");
            return;
        }

        // í‚¤ì›Œë“œë³„ ë“±ì¥ íšŸìˆ˜ ê³„ì‚°
        let keywordCounts = {};
        complaintKeywords.forEach(keyword => {
            let matches = text.match(new RegExp(keyword, "g"));
            if (matches) {
                keywordCounts[keyword] = matches.length;
            }
        });

        // í‚¤ì›Œë“œ í•˜ì´ë¼ì´íŠ¸
        let highlightedText = text;
        Object.keys(keywordCounts).forEach(keyword => {
            const regex = new RegExp(keyword, "g");
            highlightedText = highlightedText.replace(regex, `<span class="highlight">${keyword}</span>`);
        });

        if (!isComposing) {
            inputArea.innerHTML = highlightedText;
            placeCaretAtEnd(inputArea);
        }

        if (Object.keys(keywordCounts).length > 0) {
            inputArea.classList.add("warning");
            resultBox.className = "result complaint";
            resultBox.innerHTML = `ğŸš¨ ë¶ˆë§Œ ì˜ì‹¬`;

            // í‚¤ì›Œë“œ(íšŸìˆ˜) ëª©ë¡ ìƒì„±
            let keywordHTML = "ê°ì§€ëœ í‚¤ì›Œë“œ: " + Object.entries(keywordCounts)
                .map(([k, count]) => `<span class="keyword" data-key="${k}">${k}(${count})</span>`)
                .join("");

            // ì´ ê°ì§€ ë‹¨ì–´ ìˆ˜ ê³„ì‚°
            let totalCount = Object.values(keywordCounts).reduce((a, b) => a + b, 0);
            keywordHTML += `<div style="margin-top:5px;font-weight:bold;">ì´ ê°ì§€ ë‹¨ì–´ ìˆ˜: ${totalCount}ê°œ</div>`;

            keywordList.innerHTML = keywordHTML;
            clickGuide.style.display = "block";
        } else {
            inputArea.classList.remove("warning");
            resultBox.className = "result normal";
            resultBox.textContent = "ì¼ë°˜";
            keywordList.innerHTML = "";
            keywordDescBox.style.display = "none";
            clickGuide.style.display = "none";
        }
        resultBox.style.display = "block";

        // í‚¤ì›Œë“œ í´ë¦­ ì‹œ ì„¤ëª… í‘œì‹œ
        document.querySelectorAll('.keyword').forEach(span => {
            span.addEventListener('click', () => {
                const key = span.getAttribute('data-key');
                const desc = keywordDescriptions[key] || "ì„¤ëª… ì—†ìŒ";
                keywordDescBox.textContent = `ã€Œ${key}ã€ : ${desc}`;
                keywordDescBox.style.display = "block";
            });
        });
    }

    function placeCaretAtEnd(el) {
        el.focus();
        const range = document.createRange();
        range.selectNodeContents(el);
        range.collapse(false);
        const sel = window.getSelection();
        sel.removeAllRanges();
        sel.addRange(range);
    }
</script>

<!-- ğŸ”’ ë³´ì•ˆ ìƒíƒœ í‘œì‹œ -->
<script>
const statusBox = document.getElementById('securityStatus');
statusBox.textContent = "ğŸ”’ ë³´ì•ˆ ìƒíƒœ: ì•ˆì „ â€” ì™¸ë¶€ ì „ì†¡ ì—†ìŒ";
statusBox.style.color = "green";

// fetch ê°ì‹œ
const originalFetch = window.fetch;
window.fetch = function(...args) {
    statusBox.textContent = "ğŸš¨ ë³´ì•ˆ ê²½ê³ : ì™¸ë¶€ë¡œ ë°ì´í„° ì „ì†¡ ì‹œë„ ê°ì§€ë¨!";
    statusBox.style.color = "red";
    return originalFetch.apply(this, args);
};

// XMLHttpRequest ê°ì‹œ
const originalXHR = window.XMLHttpRequest;
function MonitorXHR() {
    const xhr = new originalXHR();
    xhr.addEventListener('loadstart', () => {
        statusBox.textContent = "ğŸš¨ ë³´ì•ˆ ê²½ê³ : ì™¸ë¶€ë¡œ ë°ì´í„° ì „ì†¡ ì‹œë„ ê°ì§€ë¨!";
        statusBox.style.color = "red";
    });
    return xhr;
}
window.XMLHttpRequest = MonitorXHR;
</script>

<!-- ì„¤ì¹˜ ë²„íŠ¼ ë™ì‘ -->
<script>
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById('installTrigger').style.display = 'block';
});

document.getElementById('installTrigger').addEventListener('click', () => {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then(() => {
      deferredPrompt = null;
      document.getElementById('installTrigger').style.display = 'none';
    });
  }
});
</script>

</body>
</html>

